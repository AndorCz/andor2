---
	import Layout from '@layouts/layout.astro'
  import Game from '@components/games/Game.svelte'
  import GameSettings from '@components/games/GameSettings.svelte'

  const { supabase, user } = Astro.locals
  const { gameId } = Astro.params
  const showSettings = Astro.url.searchParams.get('settings')

  const { data, error } = await supabase.rpc('get_game_data', { game_id: gameId });
  if (error) { return Astro.redirect(`/?toastType=error&toastText=${encodeURIComponent('Chyba: ' + error.message)}`) }
  const gameData = data
---

<Layout title={gameData?.name} headerStorage={gameData?.custom_header ? `game-${gameData.id}.jpg?hash=${gameData.custom_header}` : null}>
  {(showSettings ? (
    <GameSettings game={gameData} {user} client:only />
  ) : (
    <Game game={gameData} {user} client:only />
  ))}
</Layout>
