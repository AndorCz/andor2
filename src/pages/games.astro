---
	import Layout from '@layouts/layout.astro'
  import GameList from '@components/games/GameList.svelte'

  const { supabase, user } = Astro.locals
  
  const tab = Astro.url.searchParams.get('tab') || 'new'
  let query
  switch (tab) {
    case 'new':
      query = supabase.from('game_list').select('*').match({ archived: false, published: true }).order('created_at', { ascending: false })
      break
    case 'active':
      query = supabase.from('game_list').select('*').match({ archived: false, published: true }).not('last_post', 'is', null).order('last_post', { ascending: false })
      break
    case 'archive':
      query = supabase.from('game_list').select('*').match({ archived: true, published: true }).order('last_post', { ascending: false })
      break
  }
  const { data: games, error } = await query
  if (error) { console.error(error) }
---

<Layout title='Hry'>
  <GameList {user} {games} showHeadline client:load />
</Layout>
