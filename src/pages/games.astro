---
	import Layout from '@layouts/layout.astro'
  import GameList from '@components/games/GameList.svelte'

  const { supabase, user } = Astro.locals
  const sort = Astro.url.searchParams.get('sort')

  let games = []

  if (sort === 'active') {
    const { data: gamesActivity, error } = await supabase.from('game_list').select('*').order('last_post')
    if (error) { console.error(error) }
    games = gamesActivity
  } else { // newest
    const { data: gamesAll, error } = await supabase.from('game_list').select('*')
    if (error) { console.error(error) }
    games = gamesAll
  }
---

<Layout title='Hry'>
  <GameList {user} {games} showHeadline client:load />
</Layout>
