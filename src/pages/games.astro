---
	import Layout from '@layouts/layout.astro'
  import GameList from '@components/games/GameList.svelte'

  const { supabase, user } = Astro.locals
  
  const tab = Astro.url.searchParams.get('tab') || 'new'
  let query
  switch (tab) {
    case 'new':
      query = supabase.from('game_list').select('*').eq('archived', false).order('created_at')
      break
    case 'active':
      query = supabase.from('game_list').select('*').eq('archived', false).order('last_post')
      break
    case 'archive':
      query = supabase.from('game_list').select('*').eq('archived', true).order('last_post')
      break
  }
  const { data: games, error } = await query
  if (error) { console.error(error) }
  console.log('navigation fired')
---

<Layout title='Hry'>
  <GameList {user} {games} showHeadline client:load />
</Layout>
