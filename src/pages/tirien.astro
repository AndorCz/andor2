---
import LayoutTirien from '@layouts/layoutTirien.astro'

const { user } = Astro.locals

  // Get supabase user auth
const accessToken = Astro.cookies.get('sb-access-token')?.value
const refreshToken = Astro.cookies.get('sb-refresh-token')?.value

// Path based on environment
const path = import.meta.env.DEV ? 'http://localhost:5173' : 'https://tirien.cz'
const params = new URLSearchParams()
if (accessToken && refreshToken) {
  params.set('accessToken', accessToken)
  params.set('refreshToken', refreshToken)
}
params.set('embed', 'true')
const iframeSrc = `${path}?${params}`
---

<LayoutTirien title='Tirien: Hlavní město Andoru' sidePadding={false}>
  {user.id ? (
    <div class='tirien-iframe-container'>
      <iframe 
        src={iframeSrc}
        width='100%' 
        height='100%'
        frameborder='0'
        allow='autoplay; encrypted-media; fullscreen'>
      </iframe>
    </div>
  ) : (
    <center>Tato sekce je jen pro přihlášené uživatele.</center>
  )}
</LayoutTirien>

<style>
  .tirien-iframe-container {
    width: 100%;
    height: 100%;
    overlay: hidden;
  }
</style>